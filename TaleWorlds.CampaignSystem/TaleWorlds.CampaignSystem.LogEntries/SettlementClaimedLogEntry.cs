using System.Collections.Generic;
using Helpers;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries;

public class SettlementClaimedLogEntry : LogEntry, IChatNotification
{
	[SaveableField(320)]
	public readonly Hero Claimant;

	[SaveableField(321)]
	public readonly Settlement Settlement;

	[SaveableField(322)]
	private readonly Clan _settlementClan;

	public bool IsVisibleNotification => true;

	public override CampaignTime KeepInHistoryTime => CampaignTime.Weeks(240f);

	internal static void AutoGeneratedStaticCollectObjectsSettlementClaimedLogEntry(object o, List<object> collectedObjects)
	{
		((SettlementClaimedLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
		collectedObjects.Add(Claimant);
		collectedObjects.Add(Settlement);
		collectedObjects.Add(_settlementClan);
	}

	internal static object AutoGeneratedGetMemberValueClaimant(object o)
	{
		return ((SettlementClaimedLogEntry)o).Claimant;
	}

	internal static object AutoGeneratedGetMemberValueSettlement(object o)
	{
		return ((SettlementClaimedLogEntry)o).Settlement;
	}

	internal static object AutoGeneratedGetMemberValue_settlementClan(object o)
	{
		return ((SettlementClaimedLogEntry)o)._settlementClan;
	}

	public SettlementClaimedLogEntry(Hero claimant, Settlement settlement)
	{
		Claimant = claimant;
		Settlement = settlement;
		_settlementClan = settlement.OwnerClan;
	}

	public override string ToString()
	{
		return GetNotificationText().ToString();
	}

	public TextObject GetNotificationText()
	{
		TextObject textObject = new TextObject("{=ARNYrXln}{TROOP.NAME} has claimed {SIDE1_PARTY} currently held by the {SIDE2_FACTION}");
		StringHelpers.SetCharacterProperties("TROOP", Claimant.CharacterObject, textObject);
		textObject.SetTextVariable("SIDE1_PARTY", Settlement.Name);
		textObject.SetTextVariable("SIDE2_FACTION", _settlementClan.Name);
		return textObject;
	}
}

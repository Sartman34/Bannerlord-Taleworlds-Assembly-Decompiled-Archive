using System.Collections.Generic;
using TaleWorlds.Core;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries;

public class OverruleInfluenceLogEntry : LogEntry
{
	[SaveableField(260)]
	private readonly Hero _liege;

	public override CampaignTime KeepInHistoryTime => CampaignTime.Weeks(240f);

	internal static void AutoGeneratedStaticCollectObjectsOverruleInfluenceLogEntry(object o, List<object> collectedObjects)
	{
		((OverruleInfluenceLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
		collectedObjects.Add(_liege);
	}

	internal static object AutoGeneratedGetMemberValue_liege(object o)
	{
		return ((OverruleInfluenceLogEntry)o)._liege;
	}

	public OverruleInfluenceLogEntry(Hero liege, Hero wrongedLord)
	{
		_liege = liege;
	}

	public override TextObject GetHistoricComment(Hero talkTroop)
	{
		TextObject textObject = GameTexts.FindText("str_overrule_influence_historic_comment");
		textObject.SetTextVariable("HERO", _liege.Name);
		textObject.SetTextVariable("FACTION", _liege.Clan.Name);
		return textObject;
	}

	public override int GetValueAsPoliticsAbuseOfPower(Hero referenceTroop, Hero liege)
	{
		if (liege == _liege)
		{
			return 3;
		}
		return 0;
	}

	public override string ToString()
	{
		return "OverruleInfluenceLogEntry";
	}
}
